!function(e){e.fn.gracket=function(t){e.fn.gracket.defaults={gracketClass:"g_gracket",gameClass:"g_game",roundClass:"g_round",roundLabelClass:"g_round_label",teamClass:"g_team",winnerClass:"g_winner",spacerClass:"g_spacer",currentClass:"g_current",seedClass:"g_seed",cornerRadius:15,canvasId:"g_canvas",canvasClass:"g_canvas",canvasLineColor:"#eee",canvasLineCap:"round",canvasLineWidth:2,canvasLineGap:15,roundLabels:[],src:[]};var a,s,n,i=this,r="undefined"==typeof i.data("gracket")?[]:"string"==typeof i.data("gracket")?JSON.parse(i.data("gracket")):i.data("gracket"),l=[];e.fn.gracket.settings={};var d={init:function(t){this.gracket.settings=e.extend({},this.gracket.defaults,t),this.gracket.settings.src.length&&(r=this.gracket.settings.src),this.gracket.settings.canvasId=this.gracket.settings.canvasId+"_"+(new Date).getTime();var d=document.createElement("canvas");d.id=this.gracket.settings.canvasId,d.className=this.gracket.settings.canvasClass,d.style.position="absolute",d.style.left=0,d.style.top=0,d.style.right="auto",i.addClass(this.gracket.settings.gracketClass).prepend(d),s=r.length;for(var c=0;s>c;c++){var g=o.build.round(this.gracket.settings);i.append(g),n=r[c].length;for(var h=0;n>h;h++){var p=o.build.game(this.gracket.settings),v=i.find("."+this.gracket.settings.gameClass).outerHeight(!0),u=o.build.spacer(this.gracket.settings,v,c,0!==c&&0===h?!0:!1);h%1==0&&0!==c&&g.append(u),g.append(p),a=r[c][h].length;for(var f=0;a>f;f++){var m=o.build.team(r[c][h][f],this.gracket.settings);p.append(m);var C=m.outerWidth(!0);(void 0===l[c]||l[c]<C)&&(l[c]=C),1===a&&(p.prev().remove(),o.align.winner(p,this.gracket.settings,p.parent().prev().children().eq(0).height()),o.listeners(this.gracket.settings,r,p.parent().prev().children().eq(1)))}}}}},o={build:{team:function(t,a){var s=["<h3"+("undefined"==typeof t.score?"":' title="Score: '+t.score+'"')+">",'<span class="'+a.seedClass+'">',"undefined"==typeof t.displaySeed?t.seed:t.displaySeed,"</span>","&nbsp;"+t.name+"&nbsp;","<small>","undefined"==typeof t.score?"":t.score,"</small>","</h3>"].join("");return team=e("<div />",{html:s,"class":a.teamClass+" "+(t.id||"id_null")})},game:function(t){return game=e("<div />",{"class":t.gameClass})},round:function(t){return round=e("<div />",{"class":t.roundClass})},spacer:function(t,a,s,n){return spacer=e("<div />",{"class":t.spacerClass}).css({height:n?(Math.pow(2,s)-1)*(a/2):(Math.pow(2,s)-1)*a})},labels:function(t,a){var s,n,r=a,d=t.length,o=0;for(s=0;d>s;s++)n=0===s?r.padding+o:r.padding+o+r.right*s,e("<h5 />",{html:r.labels.length?r.labels[s]:"Round "+(s+1),"class":r["class"]}).css({position:"absolute",left:n,width:a.width}).prependTo(i),o+=l[s]},canvas:{resize:function(t){var a=document.getElementById(t.canvasId);a.height=i.innerHeight(),a.width=i.innerWidth(),e(a).css({height:i.innerHeight(),width:i.innerWidth(),zIndex:1,pointerEvents:"none"})},draw:function(t,a,s){var n=document.getElementById(t.canvasId);"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(n);var r=n.getContext("2d"),d=l[0],c=s.outerHeight(!0),g=parseInt(i.css("paddingLeft"))||0,h=parseInt(i.css("paddingTop"))||0,p=(parseInt(s.css("marginBottom"))||0,d+g),v=parseInt(i.find("> div").css("marginRight"))||0,u=t.cornerRadius,f=t.canvasLineGap,m=s.height()-2*s.find("> div").eq(1).height();_playerHt=s.find("> div").eq(1).height(),_totalItemWidth=0,"undefined"!=typeof console&&console.info("Padding Left: "+g+"px","Player/Name Width: "+d+"px","Container padding left: "+p+"px"),u>c/3&&(u=c/3),u>v/2&&(u=v/2-2),0>=u&&(u=1),f>v/3&&(f=v/3),r.strokeStyle=t.canvasLineColor,r.lineCap=t.canvasLineCap,r.lineWidth=t.canvasLineWidth,r.beginPath();var C,k=Math.pow(2,a.length-2),b=0,y=.5,_=0===b&&1===k?!0:!1;if(_){var w=e("."+t.gameClass),I=w.eq(w.length-1);c=I.outerHeight(!0),d=I.outerWidth(!0)}for(;k>=1;){for(C=0;k>C;C++){1==k&&(y=1);var T=_?d+g:p+_totalItemWidth+b*v,L=y*v,W=((Math.pow(2,b-1)-.5)*(b&&1)+C*Math.pow(2,b))*c+h+(_?w.find("> div").eq(1).height():_playerHt)+m/2;if(k>1?(r.moveTo(T+f,W),r.lineTo(T+L-u,W)):(r.moveTo(T+f,W),r.lineTo(T+3*f,W)),k>1&&C%2==0){var M=W+u,x=W+Math.pow(2,b)*c-u;r.moveTo(T+L,M),r.lineTo(T+L,x);var H=T+L-u,q=W+u;r.moveTo(H,q-u),r.arcTo(H+u,q-u,H+u,q,u),q=W+Math.pow(2,b)*c-u,r.moveTo(H+u,q-u),r.arcTo(H+u,q+u,H,q+u,u);var E=(M+x)/2;r.moveTo(T+L,E),r.lineTo(T+L+f,E)}}b++,d=l[b],_totalItemWidth+=d,k/=2}r.stroke(),o.build.labels(a,{padding:g,left:p,right:v,labels:t.roundLabels,"class":t.roundLabelClass})}}},align:{winner:function(e,t,a){var s=1===e.parent().siblings().not("canvas").length?!0:!1,n=s?a-(e.height()+e.height()/2):a+e.height()/2;return e.addClass(t.winnerClass).css({"margin-top":n})}},listeners:function(t,a,s){var n="."+t.teamClass+" > h3";e.each(e(n),function(a){var s="."+e(this).parent().attr("class").split(" ")[1];void 0!==s&&e(s).hover(function(){e(s).addClass(t.currentClass)},function(){e(s).removeClass(t.currentClass)})}),o.build.canvas.resize(t),o.build.canvas.draw(t,a,s)}};return d[t]?d[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error('Method "'+t+'" does not exist in gracket!'):d.init.apply(this,arguments)}}(jQuery);